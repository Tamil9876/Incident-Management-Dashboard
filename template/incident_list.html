{% extends 'base.html' %}
{% block content %}

  <h2>Incident List</h2>

<form method="get" class="mb-3 d-flex gap-2">
  <!-- Search -->
  <input type="text" name="search" value="{{ search_query }}"
         placeholder="Search failure/actions..." class="form-control">

  <!-- Risk Filter -->
  <select name="risk" class="form-select">
    <option value="All" {% if selected_risk == "All" %}selected{% endif %}>All Risks</option>
    <option value="Low" {% if selected_risk == "Low" %}selected{% endif %}>Low</option>
    <option value="Medium" {% if selected_risk == "Medium" %}selected{% endif %}>Medium</option>
    <option value="High" {% if selected_risk == "High" %}selected{% endif %}>High</option>
  </select>

  <!-- Failure Filter -->
  <select name="failure" class="form-select">
    <option value="All" {% if selected_failure == "All" %}selected{% endif %}>All Failures</option>
    {% for incident in incidents %}
      <option value="{{ incident.failure }}" {% if selected_failure == incident.failure %}selected{% endif %}>
        {{ incident.failure }}
      </option>
    {% endfor %}
  </select>

  <!-- Filter Button -->
  <button type="submit" class="btn btn-primary">Filter</button>
  <a href="{% url 'incident_list' %}" class="btn btn-secondary">Clear</a>
</form>

  </div>
  <div class="d-flex justify-content-start gap-2 mb-3">
    <a href="{% url 'download_csv' %}" class="btn btn-success">Download CSV</a>
    <a href="{% url 'download_pdf' %}?search={{ search_query }}&risk={{ selected_risk }}&failure={{ selected_failure }}" class="btn btn-danger">Download PDF Report</a>
</div>
</form>

<table class="table table-bordered table-striped">
  <thead class="table-dark">
    <tr>
      <th>Date</th>
      <th>Pressure</th>
      <th>Temperature</th>
      <th>Failure</th>
      <th>Risk</th>
      <th>Actions</th>
      <th>Operation</th>
    </tr>
  </thead>
  <tbody>
    {% for incident in incidents %}
    <tr>
      <td>{{ incident.date }}</td>
      <td>{{ incident.pressure }}</td>
      <td>{{ incident.temperature }}</td>
      <td>{{ incident.failure }}</td>
      <td>{{ incident.risk }}</td>
      <td>{{ incident.actions }}</td>

      <td>
      <a href="{% url 'incident_detail' incident.id %}" class="btn btn-info btn-sm">View</a>
      <a href="{% url 'edit_incident' incident.id %}" class="btn btn-warning btn-sm">Edit</a>
      <a href="{% url 'delete_incident' incident.id %}" class="btn btn-danger btn-sm"
         onclick="return confirm('Are you sure you want to delete this incident?');">
        Delete
      </a>
    </td>

    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
